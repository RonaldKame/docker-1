#!/bin/bash
set -x
set -e
set -o pipefail

function update() {
  docker-compose stop $1
  docker-compose kill $1
  docker-compose rm -f $1
  docker-compose up -d $1
  while ! docker exec $1 curl -s "http://localhost:8080/info"; do
    sleep 1
  done
}

if [ -d '/root/docker' ]; then
  cd '/root/docker'
  git pull --rebase
fi

./build portal-de-servicos
update portal1
update portal2
